---
title: "Habitatfiche"
date: "`r Sys.Date()`"
output: html_document
---


```{r include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```


```{r include=FALSE}

library(xtable)
library(tidyr)
library(LSVI)
library(dplyr)

```



```{r}
# VersieRapportdeel <- "Versie 3"
# HabitatsubtypeFiche <- "4010"
# ConnectieLSVIhabitats <- connecteerMetLSVIdb()

Habitatfiche <- geefInfoHabitatfiche(ConnectieLSVIhabitats = ConnectieLSVIhabitats, Versie = VersieRapportdeel, 
                                     Habitattype = HabitatsubtypeFiche)

Versie <- geefVersieInfo(ConnectieLSVIhabitats) %>%
  filter_(~VersieLSVI == VersieRapportdeel)

```


#####Habitatkarakteristieken

```{r results='asis'}

Habitatkarakteristieken <- Habitatfiche %>%
  select_(Criterium = ~Criterium.habitat, Indicator = ~Indicator.habitat,
          ~Beschrijving, ~Maatregelen, Opmerkingen = ~Opmerkingen.habitat,
          Referenties = ~Referenties.habitat) %>%
  distinct_() %>%
  mutate_(fCriterium = ~factor(Criterium, , levels = c("Vegetatie", "Structuur", "Verstoring"), ordered = TRUE)) %>%
  arrange_(~fCriterium)

for (criterium in unique(Habitatkarakteristieken$Criterium)) {
  cat("__", criterium, "__", sep = "")
  Habitattabel <- Habitatkarakteristieken %>%
    filter_(~Criterium == criterium) %>%
    select_(
      ~ Indicator, 
      ~ Beschrijving, 
      ~ Maatregelen, 
      ~ Opmerkingen, 
      ~ Referenties
    ) %>%
    xtable(digits = ncol(.))
  print(Habitattabel, type = "html", include.rownames = FALSE)
}

```


#####Beoordelingsmatrix

```{r results='asis', message=FALSE, warning=FALSE}

Beoordelingsfiche <- Habitatfiche %>%
  select_(~Beoordeling, Criterium = ~Criterium.beoordeling, 
          Indicator = ~Indicator.beoordeling, 
          Opmerkingen = ~Opmerkingen.beoordeling, 
          Referenties = ~Referenties.beoordeling,
          ~Kwaliteitsniveau) %>%
  distinct_() %>%
  inner_join(
    data.frame(Kwaliteitsniveau = c(1,2), 
               Referentieniveau = c(Versie$Kwaliteitsniveau1, 
                                    Versie$Kwaliteitsniveau2),
               stringsAsFactors = FALSE)
  ) %>%
  select(-Kwaliteitsniveau) %>%
  spread(key = Referentieniveau, value = Beoordeling) %>%
  mutate_(fCriterium = ~factor(Criterium, , levels = c("Vegetatie", "Structuur", "Verstoring"), ordered = TRUE)) %>%
  arrange_(~fCriterium)

for (Criterium in unique(Beoordelingsfiche$Criterium)) {   
  cat("__", Criterium, "__", sep = "")
  Beoordelingsmatrix <- 
    xtable(Beoordelingsfiche[Beoordelingsfiche$Criterium == Criterium,
                        c("Indicator",c(Versie$Kwaliteitsniveau1,Versie$Kwaliteitsniveau2),"Opmerkingen","Referenties")])
  print(Beoordelingsmatrix, type = "html", include.rownames = FALSE)
}

```


