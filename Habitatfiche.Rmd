---
title: "Habitatfiches"
author: "Els Lommelen"
date: "29 september 2016"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r libraries, include=FALSE}
library("RODBC")
library("dplyr")

```

```{r inladen_gegevens}

query_indicator <- "SELECT Indicator.Id AS IndicatorID, Indicator.Naam AS Indicator, Criterium.Naam AS Criterium
                    FROM Indicator INNER JOIN Criterium on Indicator.CriteriumID = Criterium.Id"


#om een of andere reden vraagt de volgende query naar parameters.  Zelfs een afgeslankte query vraagt naar parameters van zodra een van de ID's in de veldenlijst opgenomen wordt.

query_tekstfiches <- 
  "SELECT Habitatsubtype.Habitatcode_subtype, Habitatsubtype.Habitatnaam_subtype,
    Indicator_habitat.Beschijving, Indicator_habitat.Beschrijving_naSoorten, Indicator_habitat.SoortengroepID,
    Indicator_habitat.Maatregelen, Indicator_habitat.Opmerkingen AS Opmerkingen_H, Indicator_habitat.Referenties AS Referenties_H,
    Indicator_habitat.NiveauSoortlijstFiche, Indicator_habitat.IndicatorId,
    Indicator_beoordeling.Opmerkingen AS Opmerkingen_B, Indicator_beoordeling.Referenties AS Referenties_B,
    Beoordeling.Kwaliteitsniveau, Beoordeling.Beoordeling_letterlijk,
    IndicatortabellenKoppeling.Indicator_beoordelingID
  FROM ((Indicator_habitat LEFT JOIN Habitatsubtype ON Indicator_habitat.HabitatsubtypeID = Habitatsubtype.Id)
          LEFT JOIN IndicatortabellenKoppeling ON Indicator_habitat.Id = IndicatortabellenKoppeling.Indicator_habitatID)
          INNER JOIN 
              (Indicator_beoordeling INNER JOIN Beoordeling ON Indicator_beoordeling.Id = Beoordeling.Indicator_beoordelingID)
                  ON IndicatortabellenKoppeling.Indicator_beoordelingID = Indicator_beoordeling.Id
  WHERE (Indicator_habitat.VersieID='3') AND (Habitatsubtype.Habitatcode_subtype='4010')"

query_tekstfiches <- 
  "SELECT Habitatsubtype.Habitatcode_subtype, Habitatsubtype.Habitatnaam_subtype,
    Indicator_habitat.Beschijving, Indicator_habitat.Beschrijving_naSoorten, Indicator_habitat.SoortengroepID,
    Indicator_habitat.Maatregelen, Indicator_habitat.Opmerkingen AS Opmerkingen_H, Indicator_habitat.Referenties AS Referenties_H,
    Indicator_habitat.NiveauSoortlijstFiche, Indicator_habitat.IndicatorId
  FROM Indicator_habitat INNER JOIN Habitatsubtype ON Indicator_habitat.HabitatsubtypeID = Habitatsubtype.Id
  WHERE (Indicator_habitat.VersieID='3') AND (Habitatsubtype.Habitatcode_subtype='4010')"

query_soortengroep <- "SELECT Soortengroep.Id as SoortengroepID, Soortengroep.Naam, Soortengroep.Omschrijving, 
                        SoortengroepSoort.SoortID, SoortengroepSoort.SoortensubgroepID
                       FROM Soortengroep INNER JOIN SoortengroepSoort ON Soortengroep.Id = SoortengroepSoort.SoortengroepID"

query_soort <- "SELECT Soort.Id AS SoortID, Soort.WetNaam, Soort.NedNaam FROM Soort"


LSVIdb <- odbcConnectAccess2007("C://Users/els.lommelen@inbo.be/els.lommelen@inbo.be/10194_Controlelijsten/Output/LSVIdb_v4.accdb")

Indicator <- sqlQuery(LSVIdb, query_indicator, stringsAsFactors = FALSE)

Tekstfiches <- sqlQuery(LSVIdb, query_tekstfiches, stringsAsFactors = FALSE)

Soortengroep <- sqlQuery(LSVIdb, query_soortengroep, stringsAsFactors = FALSE)

Soort <- sqlQuery(LSVIdb, query_soort, stringsAsFactors = FALSE)

odbcClose(LSVIdb)

```

