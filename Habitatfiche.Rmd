---
title: "Habitatfiche"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r libraries, include=FALSE}
library("RODBC")
library("dplyr")
library("xtable")
library("tidyr")

```

```{r inladen_gegevens}

query_habitatfiche <- 
  "SELECT Habitatsubtype.Habitatcode_subtype, Habitatsubtype.Habitatnaam_subtype,
    Criterium.Naam AS Criterium, Indicator.Naam As Indicator, 
    Indicator_habitat.Beschrijving, Indicator_habitat.Beschrijving_naSoorten, 
    Indicator_habitat.Maatregelen, Indicator_habitat.Opmerkingen, Indicator_habitat.Referenties,
    Indicator_habitat.NiveauSoortlijstFiche, Indicator_habitat.SoortgroepID
  FROM (Indicator_habitat INNER JOIN Habitatsubtype ON Indicator_habitat.HabitatsubtypeID = Habitatsubtype.Id)
          INNER JOIN (Indicator INNER JOIN Criterium on Indicator.CriteriumID = Criterium.Id)
                        ON Indicator_habitat.IndicatorID = Indicator.Id
  WHERE (Indicator_habitat.VersieID=3) AND (Habitatsubtype.Habitatcode_subtype='4010')"

query_beoordelingsfiche <- 
  "SELECT Habitatsubtype.Habitatcode_subtype, Habitatsubtype.Habitatnaam_subtype,
    Criterium.Naam AS Criterium, Indicator.Naam As Indicator, 
    Indicator_beoordeling.Opmerkingen, Indicator_beoordeling.Referenties,
    Beoordeling.Kwaliteitsniveau, Beoordeling.Beoordeling_letterlijk
  FROM ((Indicator_habitat INNER JOIN Habitatsubtype ON Indicator_habitat.HabitatsubtypeID = Habitatsubtype.Id)
          INNER JOIN IndicatortabellenKoppeling ON Indicator_habitat.Id = IndicatortabellenKoppeling.Indicator_habitatID)
        INNER JOIN 
              ((Indicator_beoordeling INNER JOIN Beoordeling ON Indicator_beoordeling.Id = Beoordeling.Indicator_beoordelingID)
            INNER JOIN (Indicator INNER JOIN Criterium on Indicator.CriteriumID = Criterium.Id)
                        ON Indicator_beoordeling.IndicatorID = Indicator.Id)
          ON IndicatortabellenKoppeling.Indicator_beoordelingID = Indicator_beoordeling.Id
  WHERE (Indicator_habitat.VersieID=3) AND (Habitatsubtype.Habitatcode_subtype='4010')"

query_soortengroep <- "SELECT Soortengroep.Id as SoortengroepID, Soortengroep.Naam, Soortengroep.Omschrijving, 
                        SoortengroepSoort.SoortID, SoortengroepSoort.SoortensubgroepID
                       FROM Soortengroep INNER JOIN SoortengroepSoort ON Soortengroep.Id = SoortengroepSoort.SoortengroepID"

query_soort <- "SELECT Soort.Id AS SoortID, Soort.WetNaam, Soort.NedNaam FROM Soort"

query_versie <- "SELECT * FROM Versie WHERE Versie.ID=3"


LSVIdb <- odbcConnectAccess2007("C://Users/els.lommelen@inbo.be/els.lommelen@inbo.be/10194_Controlelijsten/Output/LSVIdb_v4.accdb")

Habitatfiche <- sqlQuery(LSVIdb, query_habitatfiche, stringsAsFactors = FALSE)

Beoordelingsfiche <- sqlQuery(LSVIdb, query_beoordelingsfiche, stringsAsFactors = FALSE)

Soortengroep <- sqlQuery(LSVIdb, query_soortengroep, stringsAsFactors = FALSE)

Soort <- sqlQuery(LSVIdb, query_soort, stringsAsFactors = FALSE)

Versie <- sqlQuery(LSVIdb, query_versie, stringsAsFactors = FALSE)

odbcClose(LSVIdb)

```


##Habitattype `r Habitatfiche[1,"Habitatcode_subtype"]`: `r Habitatfiche[1,"Habitatnaam_subtype"]`

###Habitatkarakteristieken

```{r results='asis'}
for(Criterium in unique(Habitatfiche$Criterium)){
  print(Criterium)
  Habitatkarakteristieken <- 
    xtable(Habitatfiche[Habitatfiche$Criterium==Criterium,
                        c("Indicator","Beschrijving","Maatregelen","Opmerkingen","Referenties")])
  print(Habitatkarakteristieken, type = "html")
}

```


###Beoordelingsmatrix

```{r results='asis'}
Beoordelingsfiche <- Beoordelingsfiche %>%
  inner_join(data.frame(Kwaliteitsniveau=c(1,2), Referentieniveau = c(Versie$Kwaliteitsniveau1,Versie$Kwaliteitsniveau2), stringsAsFactors = FALSE)) %>%
  select(-Kwaliteitsniveau)%>%
  spread(key = Referentieniveau, value = Beoordeling_letterlijk)

for(Criterium in unique(Beoordelingsfiche$Criterium)){
  print(Criterium)
  Beoordelingsmatrix <- 
    xtable(Beoordelingsfiche[Beoordelingsfiche$Criterium==Criterium,
                        c("Indicator","Gunstige staat","Streefwaarde","Opmerkingen","Referenties")])
  print(Beoordelingsmatrix, type = "html")
}

```

